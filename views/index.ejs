<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Message Board</title>
    <script>
        function timeAgo(dateString) {
            const now = new Date();
            const past = new Date(dateString);
            const diffInSeconds = Math.floor((now - past) / 1000);

            if (diffInSeconds < 60) {
                return `${diffInSeconds} seconds ago`;
            } else if (diffInSeconds < 3600) {
                const diffInMinutes = Math.floor(diffInSeconds / 60);
                return `${diffInMinutes} minutes ago`;
            } else if (diffInSeconds < 86400) {
                const diffInHours = Math.floor(diffInSeconds / 3600);
                return `${diffInHours} hours ago`;
            } else if (diffInSeconds < 2592000) {
                const diffInDays = Math.floor(diffInSeconds / 86400);
                return `${diffInDays} days ago`;
            } else if (diffInSeconds < 31536000) {
                const diffInMonths = Math.floor(diffInSeconds / 2592000);
                return `${diffInMonths} months ago`;
            } else {
                const diffInYears = Math.floor(diffInSeconds / 31536000);
                return `${diffInYears} years ago`;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const dateElements = document.querySelectorAll('.message-date');
            dateElements.forEach(element => {
                const dateString = element.getAttribute('data-date');
                element.textContent = timeAgo(dateString);
            });
        });
    </script>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="page-wrapper">
    <header>
        <div class="container">
            <% if (user) { %>
                <h1 class="welcome-title">Hi, <span class="username"><%= user.username %></span>!</h1>
                <nav class="user-nav">
                    <ul>
                        <li><a href="/logout" class="nav-link logout-link">Log Out</a></li>
                        <% if (!user.membership_status) { %>
                            <li><a href="/join" class="nav-link join-link">Join Club</a></li>
                        <% } %>
                        <li><a href="/messages/create" class="nav-link create-message-link">Create Post</a></li>
                    </ul>
                </nav>
            <% } else { %>
                <h1 class="site-title">Members Only</h1>
                <nav class="auth-nav">
                    <ul>
                        <li><a href="/login" class="nav-link login-link">Log In</a></li>
                        <li><a href="/register" class="nav-link register-link">Register</a></li>
                    </ul>
                </nav>
            <% } %>
        </div>
    </header>

    <main class="container">
        <div id="messages">
            <% messages.forEach((message) => { %>
                <div class="message-card">
                    <h3 class="message-title"><%= message.title %></h3>
                    <p class="message-text"><%= message.text %></p>
                    <% if (user && user.membership_status !== null) { %>
                        <div class="message-info">
                            <span class="message-date" data-date="<%= message.date %>"></span>
                            <span class="message-author">Posted by <%= message.users.username + (message.users.membership_status ? " (member)" : "") %></span>
                        </div>
                    <% } %>
                    <% if (user) { %>
                        <div class="like-section">
                            <form action="/messages/<%= message.id %>/like" method="POST" class="like-form">
                                <button type="submit" class="like-button">❤️ Like (<%= message._count?.likedBy || 0 %>)</button>
                            </form>
                        </div>
                    <% } %>
                </div>
            <% }) %>
        </div>
    </main>

    <footer class="site-footer">
        <div class="container">
            <p>&copy; 2025 Members Only.  Connect with others!</p>
        </div>
    </footer>
    </div>
</body>
</html>